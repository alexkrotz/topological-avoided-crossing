# A python program for complex-valued avoided crossings using exact and surface hopping methods. 

## Introduction
This repository contains a set of three models describing complex-valued (topological) avoided crossings 
studied in [1].
The models can be solved with either exact wavepacket (WP) dynamics using the Fourier transform method [2] or
fewest-switches surface hopping (FSSH) [3] with the gauge fixings implemented in [1] and [4].


## Basic Usage
1. Prepare an input file, use the files in /example/ as a guide.
2. Run the code as
```python
python3 main.py input_file
```
3. FSSH calculations can be run on top of each other automatically producing a new 
set of output files with a new "calculation index" appended to the end of each output
filename. 
3. The output folder includes the following observables for FSSH calculations (where n is the calculation index):
   * transmitted adiabatic populations: `pop_adb_n.npy`
   * transmitted diabatic populations: `pop_db_n.npy` 
   * transmitted diabatic momentum: `p_db_n.npy`
   * classical energy: `Ec_n.npy`
   * quantum energy: `Eq_n.npy`
   * upper adiabatic surface population histograms: `adb_1_hist_n.npy`
   * lower adiabatic surface population histograms: `adb_0_hist_n.npy`
   * upper diabatic surface population histograms: `db_1_hist_n.npy`
   * lower diabatic surface population histograms: `db_0_hist_n.npy`
   * grid x-axis: `rxgrid.npy`
   * grid y-axis: `rygrid.npy`
4. The output folder includes the following for WP calculations:
   * time-dependent wavefunction: `psi.npy`
   * list of time steps: `tdat.npy`

## Reproducing Publication Data
To reproduce the data used in [1] refer to the directory /publication_data/ for input
files, directory structure, and auxilliary scripts. 
1. In each model directory, `model_A`, `model_B`, `model_C` there is a directory structure
organizing the different parameters for each calculation. Each folder containing a file
called `scan_template` is one where a calculation is to be run.
2. To run a calculation navigate to the relevant folder, for instance:
   ```bash
   cd publication_data/model_A/SH/Dmin/db_0/Bx1.0By0.0W2.0/
   ```
3. Modity the file `run_scan.sh` with any SLURM commands and the path to `main.py`.
4. Then use `run_scan.sh` to execute the scan over initial momenta in the folder
containing `scan_template` by executing
   ```bash
   bash path/to/run_scan.sh 
   ```
5. In that same folder, use the script `sh_obs.py` to generate observables for FSSH calculations
by running 
   ```bash
   python /path/to/sh_obs.py 'A0.02' 
   ```
   where `A0.02` is the output directory determined by `run_scan.sh`.
6. For WP calculations, you should instead run `wp_obs.py` as
   ```bash
   python /path/to/wp_obs.py 'A0.02'
   ```
7. The result of the observables calculation is a directory `data` containing the following
observables used in the publication:

   * initial x-direction momentum: `px_list_A_sh(wp).csv`
   * transmitted populations on the upper diabatic surface: `pop1_list_A_sh(wp).csv`
   * transmitted populations on the lower diabatic surface: `pop0_list_A_sh(wp).csv`
   * transmitted x-direction momentum on the upper diabatic surface: `tpx1_list_A_sh(wp).csv`
   * transmitted x-direction momentum on the lower diabatic surface: `tpx0_list_A_sh(wp).csv`
   * transmitted y-direction momentum on the upper diabatic surface: `tpy1_list_A_sh(wp).csv`
   * transmitted y-direction momentum on the lower diabatic surface: `tpy0_list_A_sh(wp).csv`
8. To generate the heatmaps necessary for the animated videos of the dynamics use the scripts `wp_heatmap.py`
and `sh_heatmap.py` in the directory of the particular calculations generated by `run_scan.sh`, for instance 
if used as given the folder `A0.02/p8/` should exist containing the calculation output as well as an input file similar to
`WP_0.0_0.02_1.0_0.0_0_8_0.in` or `FSSH_0.0_0.02_1.0_0.0_0_8_0.in`, these are the calculation specific input files.
9. Once you have navigated to the folder containing the calculation specific input file, you can generate heatmaps of the 
dynamics as
   ```bash
   python /path/to/sh_heatmap.py calculation_specific_input_file
   ```
   or as

   ```bash
   python /path/to/wp_heatmap.py calculation_specific_input_file MODEL
   ```
   where `MODEL` is either `'model_A'`, `'model_B'`, or `'model_C'`. The result should be a directory 
called `heatmap` containing the files:
   * population heatmap on upper diabatic surface at time t: `rho_db_1_t.csv`
   * population heatmap on lower diabatic surface at time t: `rho_db_0_t.csv`
   * population heatmap on upper adiabatic surface at time t: `rho_adb_1_t.csv`
   * population heatmap on lower adiabatic surface at time t: `rho_adb_0_t.csv`
   * grid x-axis: `rxgrid.csv`
   * grid y-axis: `rygrid.csv`
   * time axis: `tdat.csv`
## References
[1] Krotz, A. and Tempelaar, R. Treating Geometric Phase Effects in Nonadiabatic Dynamics.
Phys. Rev. A 109, 2024, 032210.

[2] Kosloff, D.; Kosloff, R. A Fourier Method Solution for the Time Dependent Schrödinger Equation
as a Tool in Molecular Dynamics. J. Comput. Phys. 1983, 52 (1), 35–53.

[3] Hammes-Schiffer, S. and Tully, J. C. Proton Transfer in Solution: Molecular Dynamics with
Quantum Transitions. J. Chem. Phys. 101, 1994, 4657–4667.

[4] Miao, G.; Bellonzi, N.; Subotnik, J. An Extension of the Fewest Switches Surface Hopping 
Algorithm to Complex Hamiltonians and Photophysics in Magnetic Fields: Berry Curvature and 
“Magnetic” Forces. J. Chem. Phys. 2019, 150 (12), 124101.
